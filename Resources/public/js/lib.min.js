// Ajax manager
(function(b){var m={},o={};b.manageAjax=function(){return{create:function(a,c){m[a]=new b.manageAjax._manager(a,c);return m[a]},destroy:function(a){if(m[a]){m[a].clear(true);delete m[a]}}}}();b.manageAjax._manager=function(a,c){this.requests={};this.inProgress=0;this.qName=this.name=a;this.opts=b.extend({},b.ajaxSettings,b.manageAjax.defaults,c);if(c&&c.queue&&c.queue!==true&&typeof c.queue==="string"&&c.queue!=="clear")this.qName=c.queue};b.manageAjax._manager.prototype={add:function(a){a=b.extend({},this.opts,a);var c=a.complete||b.noop,f=a.success||b.noop,g=a.beforeSend||b.noop,d=a.error||b.noop,e=typeof a.data=="string"?a.data:b.param(a.data||{}),k=a.type+a.url+e,n=this,l=this._createAjax(k,a,f,c);if(!(this.requests[k]&&a.preventDoubbleRequests)){l.xhrID=k;a.xhrID=k;a.beforeSend=function(i,h){var j=g.call(this,i,h);j===false&&n._removeXHR(k);return j};a.complete=function(i,h){n._complete.call(n,this,c,i,h,k,a)};a.success=function(i,h,j){n._success.call(n,this,f,i,h,j,a)};a.error=function(i,h,j){var p="",q="";if(h!=="timeout"&&i){p=i.status;q=i.responseXML||i.responseText}d?d.call(this,i,h,j,a):setTimeout(function(){throw h+"| status: "+p+" | URL: "+a.url+" | data: "+e+" | thrown: "+j+" | response: "+q;},0);i=null};a.queue==="clear"&&b(document).clearQueue(this.qName);if(a.queue){b.queue(document,this.qName,l);this.inProgress<a.maxRequests&&b.dequeue(document,this.qName);return k}return l()}},_createAjax:function(a,c,f,g){var d=this;return function(){if(c.beforeCreate.call(c.context||d,a,c)!==false){d.inProgress++;d.inProgress===1&&b.event.trigger(d.name+"AjaxStart");if(c.cacheResponse&&o[a]){d.requests[a]={};setTimeout(function(){d._complete.call(d,c.context||c,g,o[a],"success",a,c);d._success.call(d,c.context||c,f,o[a]._successData,"success",o[a],c)},0)}else if(c.async)d.requests[a]=b.ajax(c);else b.ajax(c);return a}}},_removeXHR:function(a){this.opts.queue&&b.dequeue(document,this.qName);this.inProgress--;this.requests[a]=null;delete this.requests[a]},_isAbort:function(a,c){return!!(c.abortIsNoSuccess&&(!a||a.readyState===0||this.lastAbort===c.xhrID))},_complete:function(a,c,f,g,d,e){if(this._isAbort(f,e)){g="abort";e.abort.call(a,f,g,e)}c.call(a,f,g,e);b.event.trigger(this.name+"AjaxComplete",[f,g,e]);e.domCompleteTrigger&&b(e.domCompleteTrigger).trigger(this.name+"DOMComplete",[f,g,e]).trigger("DOMComplete",[f,g,e]);this._removeXHR(d);this.inProgress||b.event.trigger(this.name+"AjaxStop")},_success:function(a,c,f,g,d,e){var k=this;if(!this._isAbort(d,e)){e.abortOld&&b.each(this.requests,function(h){if(h===e.xhrID)return false;k.abort(h)});if(e.cacheResponse&&!o[e.xhrID]){o[e.xhrID]={status:d.status,statusText:d.statusText,responseText:d.responseText,responseXML:d.responseXML,_successData:f};if("getAllResponseHeaders"in d){var n=d.getAllResponseHeaders(),l,i=function(){if(!l){l={};b.each(n.split("\n"),function(h,j){var p=j.indexOf(":");l[j.substr(0,p)]=j.substr(p+2)})}};b.extend(o[e.xhrID],{getAllResponseHeaders:function(){return n},getResponseHeader:function(h){i();return h in l?l[h]:null}})}}c.call(a,f,g,d,e);b.event.trigger(this.name+"AjaxSuccess",[d,e,f]);e.domSuccessTrigger&&b(e.domSuccessTrigger).trigger(this.name+"DOMSuccess",[f,e]).trigger("DOMSuccess",[f,e])}d=null},getData:function(a){if(a){var c=this.requests[a];if(!c&&this.opts.queue)c=b.grep(b(document).queue(this.qName),function(f){return f.xhrID===a})[0];return c}return{requests:this.requests,queue:this.opts.queue?b(document).queue(this.qName):[],inProgress:this.inProgress}},abort:function(a){var c;if(a){if((c=this.getData(a))&&c.abort){this.lastAbort=a;c.abort();this.lastAbort=false}else b(document).queue(this.qName,b.grep(b(document).queue(this.qName),function(d){return d!==c}));c=null}else{var f=this,g=[];b.each(this.requests,function(d){g.push(d)});b.each(g,function(d,e){f.abort(e)})}},clear:function(a){b(document).clearQueue(this.qName);a&&this.abort()}};b.manageAjax._manager.prototype.getXHR=b.manageAjax._manager.prototype.getData;b.manageAjax.defaults={beforeCreate:b.noop,abort:b.noop,abortIsNoSuccess:true,maxRequests:1,cacheResponse:false,domCompleteTrigger:false,domSuccessTrigger:false,preventDoubbleRequests:true,queue:false};b.each(b.manageAjax._manager.prototype,function(a,c){a.indexOf("_")===0||!b.isFunction(c)||(b.manageAjax[a]=function(f,g){if(!m[f])if(a==="add")b.manageAjax.create(f,g);else return;var d=Array.prototype.slice.call(arguments,1);m[f][a].apply(m[f],d)})})})(jQuery);

// tipsy
(function(b){function j(a){if(a.attr("title")||typeof a.attr("original-title")!="string")a.attr("original-title",a.attr("title")||"").removeAttr("title")}function k(a,c){this.$element=b(a);this.options=c;this.enabled=true;j(this.$element)}k.prototype={show:function(){var a=this.getTitle();if(a&&this.enabled){var c=this.tip();c.find(".tipsy-inner")[this.options.html?"html":"text"](a);c[0].className="tipsy";c.remove().css({top:0,left:0,visibility:"hidden",display:"block"}).appendTo(document.body);a= b.extend({},this.$element.offset(),{width:this.$element[0].offsetWidth,height:this.$element[0].offsetHeight});var d=c[0].offsetWidth,h=c[0].offsetHeight,f=typeof this.options.gravity=="function"?this.options.gravity.call(this.$element[0]):this.options.gravity,g;switch(f.charAt(0)){case "n":g={top:a.top+a.height+this.options.offset,left:a.left+a.width/2-d/2};break;case "s":g={top:a.top-h-this.options.offset,left:a.left+a.width/2-d/2};break;case "e":g={top:a.top+a.height/2-h/2,left:a.left-d-this.options.offset}; break;case "w":g={top:a.top+a.height/2-h/2,left:a.left+a.width+this.options.offset};break}if(f.length==2)g.left=f.charAt(1)=="w"?a.left+a.width/2-15:a.left+a.width/2-d+15;c.css(g).addClass("tipsy-"+f);this.options.fade?c.stop().css({opacity:0,display:"block",visibility:"visible"}).animate({opacity:this.options.opacity}):c.css({visibility:"visible",opacity:this.options.opacity})}},hide:function(){this.options.fade?this.tip().stop().fadeOut(function(){b(this).remove()}):this.tip().remove()},getTitle:function(){var a, c=this.$element,d=this.options;j(c);d=this.options;if(typeof d.title=="string")a=c.attr(d.title=="title"?"original-title":d.title);else if(typeof d.title=="function")a=d.title.call(c[0]);return(a=(""+a).replace(/(^\s*|\s*$)/,""))||d.fallback},tip:function(){if(!this.$tip)this.$tip=b('<div class="tipsy"></div>').html('<div class="tipsy-arrow"></div><div class="tipsy-inner"></div>');return this.$tip},validate:function(){if(!this.$element[0].parentNode){this.hide();this.options=this.$element=null}}, enable:function(){this.enabled=true},disable:function(){this.enabled=false},toggleEnabled:function(){this.enabled=!this.enabled}};b.fn.tipsy=function(a){function c(e){var i=b.data(e,"tipsy");if(!i){i=new k(e,b.fn.tipsy.elementOptions(e,a));b.data(e,"tipsy",i)}return i}function d(){var e=c(this);e.hoverState="in";a.delayIn==0?e.show():setTimeout(function(){e.hoverState=="in"&&e.show()},a.delayIn)}function h(){var e=c(this);e.hoverState="out";a.delayOut==0?e.hide():setTimeout(function(){e.hoverState== "out"&&e.hide()},a.delayOut)}if(a===true)return this.data("tipsy");else if(typeof a=="string"){var f=this.data("tipsy");f&&f[a]();return this}a=b.extend({},b.fn.tipsy.defaults,a);a.live||this.each(function(){c(this)});if(a.trigger!="manual"){f=a.live?"live":"bind";var g=a.trigger=="hover"?"mouseleave":"blur";this[f](a.trigger=="hover"?"mouseenter":"focus",d)[f](g,h)}return this};b.fn.tipsy.defaults={delayIn:0,delayOut:0,fade:false,fallback:"",gravity:"n",html:false,live:false,offset:0,opacity:0.8, title:"title",trigger:"hover"};b.fn.tipsy.elementOptions=function(a,c){return b.metadata?b.extend({},c,b(a).metadata()):c};b.fn.tipsy.autoNS=function(){return b(this).offset().top>b(document).scrollTop()+b(window).height()/2?"s":"n"};b.fn.tipsy.autoWE=function(){return b(this).offset().left>b(document).scrollLeft()+b(window).width()/2?"e":"w"}})(jQuery);
